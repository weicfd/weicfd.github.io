(function(e){function t(t){for(var r,i,l=t[0],s=t[1],c=t[2],d=0,p=[];d<l.length;d++)i=l[d],Object.prototype.hasOwnProperty.call(o,i)&&o[i]&&p.push(o[i][0]),o[i]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r]);u&&u(t);while(p.length)p.shift()();return a.push.apply(a,c||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,l=1;l<n.length;l++){var s=n[l];0!==o[s]&&(r=!1)}r&&(a.splice(t--,1),e=i(i.s=n[0]))}return e}var r={},o={app:0},a=[];function i(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],s=l.push.bind(l);l.push=t,l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var u=s;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";n("85ec")},"07f9":function(e,t,n){"use strict";n("787c")},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("2b0e"),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("Home",{attrs:{msg:"1to1 Video Call Demo"}})],1)},a=[],i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"home"},[n("header",[n("h1",[e._v(e._s(e.msg))])]),n("el-form",{ref:"form",attrs:{model:e.option,"label-width":"120px"}},[n("el-form-item",{attrs:{label:"* Appid"}},[n("el-input",{model:{value:e.option.appid,callback:function(t){e.$set(e.option,"appid",t)},expression:"option.appid"}})],1),n("el-form-item",{attrs:{label:"* Channel Name"}},[n("el-input",{model:{value:e.option.channel,callback:function(t){e.$set(e.option,"channel",t)},expression:"option.channel"}})],1),n("el-form-item",{attrs:{label:"Token"}},[n("el-input",{model:{value:e.option.token,callback:function(t){e.$set(e.option,"token",t)},expression:"option.token"}})],1),n("el-form-item",[n("el-button",{attrs:{type:"primary",disabled:e.joined},on:{click:e.joinEvent}},[e._v("join")]),n("el-button",{attrs:{type:"primary",plain:"",disabled:!e.joined},on:{click:e.leaveEvent}},[e._v("leave")]),n("el-button",{attrs:{type:"primary",plain:"",disabled:!e.joined||e.published},on:{click:e.publishEvent}},[e._v("publish")]),n("el-button",{attrs:{type:"primary",plain:"",disabled:!e.joined||!e.published},on:{click:e.unpublishEvent}},[e._v("unpublish")])],1)],1),n("el-collapse",{staticClass:"advanced"},[n("el-collapse-item",{attrs:{title:"ADVANCED SETTINGS"}},[n("el-form",{ref:"form",attrs:{model:e.option,"label-width":"120px"}},[n("el-form-item",{attrs:{label:"UID"}},[n("el-input",{model:{value:e.option.uid,callback:function(t){e.$set(e.option,"uid",t)},expression:"option.uid"}})],1),n("el-form-item",{attrs:{label:"CAMERA"}},[n("el-select",{model:{value:e.option.cameraId,callback:function(t){e.$set(e.option,"cameraId",t)},expression:"option.cameraId"}},e._l(e.cameraIds,(function(e,t){return n("el-option",{key:t,attrs:{label:e.name,value:e.value}})})),1)],1),n("el-form-item",{attrs:{label:"MICROPHONE"}},[n("el-select",{model:{value:e.option.microphoneId,callback:function(t){e.$set(e.option,"microphoneId",t)},expression:"option.microphoneId"}},e._l(e.microphoneIds,(function(e,t){return n("el-option",{key:t,attrs:{label:e.name,value:e.value}})})),1)],1),n("el-form-item",{attrs:{label:"CAMERA RESOLUTION"}},[n("el-select",{model:{value:e.option.cameraResolution,callback:function(t){e.$set(e.option,"cameraResolution",t)},expression:"option.cameraResolution"}},e._l(e.cameraResolutions,(function(e,t){return n("el-option",{key:t,attrs:{label:e.name,value:e.value}})})),1)],1),n("el-form-item",{attrs:{label:"MODE"}},[n("el-radio-group",{model:{value:e.option.mode,callback:function(t){e.$set(e.option,"mode",t)},expression:"option.mode"}},[n("el-radio",{attrs:{label:"live"}}),n("el-radio",{attrs:{label:"rtc"}})],1)],1),n("el-form-item",{attrs:{label:"CODEC"}},[n("el-radio-group",{model:{value:e.option.codec,callback:function(t){e.$set(e.option,"codec",t)},expression:"option.codec"}},[n("el-radio",{attrs:{label:"h264"}}),n("el-radio",{attrs:{label:"vp8"}})],1)],1)],1)],1)],1),n("div",{staticClass:"agora-view"},[n("div",{staticClass:"agora-video"},[e.localStream?n("StreamPlayer",{attrs:{stream:e.localStream,domId:e.localStream.getId()}}):e._e()],1),e._l(e.remoteStreams,(function(e,t){return n("div",{key:t,staticClass:"agora-video"},[n("StreamPlayer",{attrs:{stream:e,domId:e.getId()}})],1)}))],2)],1)},l=[],s=(n("4de4"),n("7db0"),n("96cf"),n("1da1")),c=(n("c975"),n("a15b"),n("d81d"),n("d3b7"),n("d4ec")),u=n("bee2"),d=n("6b5f"),p=n.n(d),m=n("faa1"),f=n.n(m),v=function(){function e(){Object(c["a"])(this,e),this.option={mode:"",codec:"",appid:"",channel:"",uid:0,token:"",microphoneId:"",cameraId:""},this.client=null,this.localStream=null,this.published=!1,this._eventBus=new f.a}return Object(u["a"])(e,[{key:"getDevices",value:function(){return console.log("getDevices"),new Promise((function(e,t){p.a.getDevices((function(t){console.log("get devices success"),t.filter((function(e){return-1!==["audioinput","videoinput"].indexOf(e.kind)})).map((function(e){return{name:e.label,value:e.deviceId,kind:e.kind}}));for(var n=[],r=[],o=0;o<t.length;o++){var a=t[o];if("videoinput"==a.kind){var i=a.label,l=a.deviceId;i||(i="camera-"+n.length),n.push({name:i,value:l,kind:a.kind})}if("audioinput"==a.kind){var s=a.label,c=a.deviceId;s||(s="microphone-"+r.length),r.push({name:s,value:c,kind:a.kind})}}e({videos:n,audios:r})}),(function(e){t(e),console.error("get devices failed",e)}))}))}},{key:"joinChannel",value:function(e){var t=this;return new Promise((function(n,r){console.log("joinChannel",e.mode,e.codec),t.client=p.a.createClient({mode:e.mode,codec:e.codec}),t.client.init(e.appid,(function(){console.log("init success"),t.clientListener(),t.client.join(e.token?e.token:null,e.channel,e.uid?+e.uid:null,(function(r){console.log("join channel: "+t.option.channel+" success, uid: ",r),t.option={appid:e.appid,token:e.token,channel:e.channel,uid:r,microphoneId:e.microphoneId,cameraId:e.cameraId},n()}),(function(e){r(e),console.error("client join failed",e)}))}),(function(e){r(e),console.error(e)})),console.log("[agora-vue] appId",e.appid)}))}},{key:"publishStream",value:function(){var e=this;return new Promise((function(t,n){e.localStream=p.a.createStream({streamID:e.option.uid,audio:!0,video:!0,screen:!1,microphoneId:e.option.microphoneId,cameraId:e.option.cameraId}),e.localStream.init((function(){console.log("init local stream success"),t(e.localStream),e.client.publish(e.localStream,(function(e){console.log("publish failed"),console.error(e)})),e.published=!0}),(function(e){n(e),console.error("init local stream failed ",e)}))}))}},{key:"clientListener",value:function(){var e=this,t=this.client;t.on("stream-added",(function(t){e._eventBus.emit("stream-added",t)})),t.on("stream-subscribed",(function(t){e._eventBus.emit("stream-subscribed",t)})),t.on("stream-removed",(function(t){e._eventBus.emit("stream-removed",t)})),t.on("peer-online",(function(t){e._eventBus.emit("peer-online",t)})),t.on("peer-leave",(function(t){e._eventBus.emit("peer-leave",t)}))}},{key:"on",value:function(e,t){this._eventBus.on(e,t)}},{key:"unpublishStream",value:function(){var e=this;return this.published=!1,new Promise((function(t,n){e.client.unpublish(e.localStream,(function(e){n(e),console.log(e)})),t()}))}},{key:"leaveChannel",value:function(){var e=this;return new Promise((function(t,n){e.client.leave((function(){e.localStream.isPlaying()&&e.localStream.stop(),e.localStream.close(),e.client=null,t(),console.log("client leaves channel success")}),(function(e){n(e),console.log("channel leave failed"),console.error(e)}))}))}}]),e}(),h=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"player",staticClass:"agora-video-player",attrs:{id:e.domId}})},b=[],g={name:"stream-player",props:["stream","domId"],mounted:function(){this.$nextTick((function(){this.stream&&!this.stream.isPlaying()&&this.stream.play("".concat(this.domId),{fit:"cover"},(function(e){e&&"aborted"!==e.status&&console.warn("trigger autoplay policy")}))}))},beforeDestroy:function(){this.stream&&(this.stream.isPlaying()&&this.stream.stop(),this.stream.close())}},y=g,k=(n("07f9"),n("2877")),I=Object(k["a"])(y,h,b,!1,null,null,null),x=I.exports,S=console.log.bind(console),j={name:"home",props:{msg:String},components:{StreamPlayer:x},data:function(){return{option:{appid:"",channel:"",token:"",uid:"",cameraId:"",microphoneId:"",cameraResolution:"default",mode:"live",codec:"h264"},cameraIds:[],microphoneIds:[],cameraResolutions:[{name:"default",value:"default"},{name:"480p",value:"480p"},{name:"720p",value:"720p"},{name:"1080p",value:"1080p"}],joined:!1,published:!1,localStream:null,remoteStreams:[]}},methods:{publishEvent:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.rtc.client){t.next=3;break}return e.messageNotify("error","Please Join Room First"),t.abrupt("return");case 3:if(!e.rtc.published){t.next=6;break}return e.messageNotify("error","Your already published"),t.abrupt("return");case 6:return n=e.rtc.published,t.prev=7,t.next=10,e.rtc.publishStream();case 10:r=t.sent,e.messageNotify("success","Publish Success"),e.localStream=r,t.next=21;break;case 15:return t.prev=15,t.t0=t["catch"](7),e.rtc.published=n,e.messageNotify("error","Publish Failure:"+t.t0),S("publish channel error",t.t0),t.abrupt("return");case 21:e.published=e.rtc.published,e.joined=!0;case 23:case"end":return t.stop()}}),t,null,[[7,15]])})))()},unpublishEvent:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.rtc.client){t.next=3;break}return e.messageNotify("error","Please Join Room First"),t.abrupt("return");case 3:if(!e.joined||e.rtc.published){t.next=6;break}return e.messageNotify("error","Your didn't publish"),t.abrupt("return");case 6:return n=e.rtc.published,t.prev=7,t.next=10,e.rtc.unpublishStream();case 10:e.messageNotify("success","Unpublish Success"),t.next=19;break;case 13:return t.prev=13,t.t0=t["catch"](7),e.rtc.published=n,e.messageNotify("error","Unpublish Failure:"+t.t0),S("unpublish channel error",t.t0),t.abrupt("return");case 19:e.published=e.rtc.published;case 20:case"end":return t.stop()}}),t,null,[[7,13]])})))()},joinEvent:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.option.appid){t.next=3;break}return e.messageNotify("error","Please enter an Appid"),t.abrupt("return");case 3:if(e.option.channel){t.next=6;break}return e.messageNotify("error","Please enter a Channel Name"),t.abrupt("return");case 6:return t.prev=6,t.next=9,e.rtc.joinChannel(e.option);case 9:e.messageNotify("success","Join Success"),t.next=17;break;case 12:return t.prev=12,t.t0=t["catch"](6),e.messageNotify("error","Join Failure:"+t.t0),S("join channel error",t.t0),t.abrupt("return");case 17:return t.next=19,e.publishEvent();case 19:case"end":return t.stop()}}),t,null,[[6,12]])})))()},leaveEvent:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.joined=!1,!e.published){t.next=4;break}return t.next=4,e.unpublishEvent();case 4:return t.prev=4,t.next=7,e.rtc.leaveChannel();case 7:e.messageNotify("success","Leave Success"),t.next=15;break;case 10:return t.prev=10,t.t0=t["catch"](4),e.messageNotify("error","Leave Failure:"+t.t0),S("leave error",t.t0),t.abrupt("return");case 15:e.localStream=null,e.remoteStreams=[];case 17:case"end":return t.stop()}}),t,null,[[4,10]])})))()},messageNotify:function(e,t){this.$message({message:t,type:e})}},created:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.rtc=new v,n=e.rtc,t.next=4,n.getDevices();case 4:r=t.sent,e.microphoneIds=r.audios,e.option.microphoneId=e.microphoneIds[0].value,e.cameraIds=r.videos,e.option.cameraId=e.cameraIds[0].value,n.on("stream-added",(function(e){var t=e.stream;S("[agora] [stream-added] stream-added",t.getId()),n.client.subscribe(t)})),n.on("stream-subscribed",(function(t){var n=t.stream;S("[agora] [stream-subscribed] stream-added",n.getId()),e.remoteStreams.find((function(e){return e.getId()===n.getId()}))||e.remoteStreams.push(n)})),n.on("stream-removed",(function(t){var n=t.stream;S("[agora] [stream-removed] stream-removed",n.getId()),e.remoteStreams=e.remoteStreams.filter((function(e){return e.getId()!==n.getId()}))})),n.on("peer-online",(function(t){e.$message("Peer ".concat(t.uid," is online"))})),n.on("peer-leave",(function(t){e.$message("Peer ".concat(t.uid," already leave")),e.remoteStreams=e.remoteStreams.filter((function(e){return e.getId()!==t.uid}))}));case 14:case"end":return t.stop()}}),t)})))()}},w=j,_=(n("6df2"),Object(k["a"])(w,i,l,!1,null,"dfe8ff9c",null)),O=_.exports,P={name:"app",components:{Home:O}},R=P,C=(n("034f"),Object(k["a"])(R,o,a,!1,null,null,null)),E=C.exports,N=n("5c96"),$=n.n(N);n("0fae");r["default"].use($.a),r["default"].config.productionTip=!1,new r["default"]({render:function(e){return e(E)}}).$mount("#app")},"6df2":function(e,t,n){"use strict";n("8488")},"787c":function(e,t,n){},8488:function(e,t,n){},"85ec":function(e,t,n){}});
//# sourceMappingURL=app.cbbb0474.js.map